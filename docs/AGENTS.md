# リポジトリガイドライン

## プロジェクト構造とモジュール構成
コードを追加するときはルートを整理した状態に保つこと。機能ロジックは `src/` に置き、`src/modules/<feature>` 配下にモジュールをまとめる。共有 UI は `src/components/ui`、ドメインフックは `src/hooks`、設定や定数は `src/lib` に配置する。Vitest のフィクスチャは `tests/` に保存し、`src` ツリーを反映させる（例: `src/modules/trades` ↔ `tests/modules/trades`）。静的アセットは `public/`、仕様や図は `docs/`、自動化ユーティリティは `scripts/` を使用する。

## ビルド・テスト・開発コマンド
依存関係を取得するために `npm install` を一度実行する。Vite の開発サーバーは `npm run dev`、本番ビルドは `npm run build`、出力のローカル確認は `npm run preview` を使う。`npm run lint` で共有設定の ESLint を動かし、`npm run test` で Vitest を実行する。しきい値を確認するときは `--coverage` を付与する。

## コーディングスタイルと命名規則
TypeScript で 2 スペースインデント・セミコロン有効・デフォルトはシングルクォートでコードを書く。React コンポーネントやクラスは `PascalCase`、フックやユーティリティ関数は `camelCase`、環境定数は `SCREAMING_SNAKE_CASE` で命名する。1 ファイル 1 コンポーネントを守り、モジュールが葉の UI でない限り default export はやめる。コミット前に Prettier（`npm run lint -- --fix`）を実行する。

## テスト方針
Vitest と Testing Library を利用し、`screen.getByRole` などのアクセシブルなクエリに頼る。モックは `tests/mocks` に共置し、`beforeEach` でリセットする。ビジネスロジックに触れる各モジュールでハッピーパス・エッジケース・リグレッションを網羅する。ステートメントカバレッジは 90%以上を目標とし、未達の場合は PR 説明で不足理由を明記する。ルーティングやストア配線のスモークテストは `tests/integration` に置き、リリース前に実行する。

## コミットとプルリクエストの方針
履歴はまだ空なので Conventional Commits（例: `feat(policy): enforce guardrails form`）を採用する。本文には課題 ID とテスト結果（`npm run test`, `npm run lint`）を記載する。プルリクエストには短い概要、検証ステップのチェックリスト、UI 変更のスクリーンショット、最低 1 名のレビュワーが必要。差分は概ね 400 行以内に抑え、雑務は別 PR に分割する。作業中はドラフト PR を使い、lint/test 通過後にのみレビューを依頼する。

## セキュリティと設定のヒント
秘密値は `.env.local`（gitignore 済み）に保存し、必要なキーは `.env.example` に記載する。`src/lib/api` で外部データを検証してから状態変更を行い、HTTPS フェッチを優先し、サードパーティのバージョンは固定して予期せぬ更新を防ぐ。毎月 `npm audit fix` または `npx npm-check-updates` を実行し、手動のハードニングは `docs/security.md` に記録する。

---

## プロジェクト固有のエージェントルール（Temperance）

### ロール
あなたはプロジェクト「Temperance」の実装エージェントである。スコープを広げず、指定どおりに MVP を実装する責務がある。

### 信頼できる情報源
- SPEC.md だけが唯一のソース・オブ・トゥルース。
- 仕様を再解釈・最適化・拡張しない。
- 不明点があれば実装前に質問する。

### スコープ管理（厳格）
- SPEC.md に明記されていない機能・画面・概念を追加しない。
- 認証、アカウント、バックエンド、API、クラウド同期を導入しない。
- Mentor Level 2 や Level 3（LLM ベース機能）を実装しない。
- アナリティクス、トラッキング、通知を追加しない。

### デザイン哲学
- このアプリは設計上ローカルファーストかつオフラインファースト。
- UX の速さとシンプルさをアーキテクチャの優雅さより重視する。
- シンプルで信頼できる「退屈な」実装を選ぶ。
- IndexedDB がソース・オブ・トゥルースであり、UI はローカルデータのみを反映する。

### 用語と表現
- SPEC.md で定義された用語のみを使う。
- UI 文言では以下の語を絶対に使わない。
  - 節約, 我慢, 管理, 診断, 反省, 〜すべき
- 以下の語は優先して維持する。
  - 節制利益, 獲得, 累積, 目標, 判断

### UX 原則
- ユーザーに説教しない。
- ユーザーを評価しない。
- 行動を強制しない。
- テキストは 1〜2 文に収める。
- メンターは命令ではなく選択肢を提示する。

### 実装スタイル
- 段階的に実装する。
- 各主要ステップ後にアプリが動作することを確認する。
- 過度な抽象化やオーバーエンジニアリングを避ける。
- 動くコードを説明より優先する。

### 出力への期待
- 動作するコードの作成に集中する。
- 推測による提案や再設計の提案を避ける。
- 迷った場合は SPEC.md を満たす最もシンプルな解決策を選ぶ。
