# Temperance

「節制利益（使うはずだったお金を使わずに済んだ分）」を記録していくローカルファーストのアプリです。スマホでサッと記録できて、目標金額への進み具合や累積グラフをリアルタイムで確認できます。

## 主な機能
- **ホーム画面**: 今日の節制利益、累積、目標カード（達成率・残額・予測到達日）、折れ線グラフ、メンターTipsを表示。
- **獲得画面**: プリセット一覧と自由入力フォーム。ボタン1回で節制利益ログを登録でき、Undoトーストでミスにも対応。
- **履歴画面**: 日付ごとにログを一覧化し、合計や削除操作ができる。
- **設定画面**: 目標金額、メンター表示回数、プリセット管理、自由入力の自動登録、バックアップ（JSON）を管理。
- **PWA対応**: Manifest + Service Worker を用意しており、Androidの「ホーム画面に追加」に対応。IndexedDBでオフラインでも動作。

## 使い方（基本コマンド）
```bash
npm install       # 依存パッケージをインストール
npm run dev       # 開発サーバー (http://localhost:3000)
npm run lint      # コードチェック
npm run build     # 本番ビルド
npm run start     # 本番ビルドの確認
```

## 技術メモ
- **Next.js App Router + React 19** を採用。最大幅 420px のモバイルUIを意識。
- **IndexedDB + Dexie** でローカルデータを管理。`dexie-react-hooks` を使って画面をリアルタイム更新。
- **lib/aggregates.ts** で今日の合計や累積、7日平均などを計算。
- **lib/tips.ts** でメンターTipsの出現回数やカテゴリ優先を制御。
- **lib/backup.ts** でJSONエクスポート/インポートを実装し、端末間のデータ移行をサポート。
- **効果音**: `/public/audio/coin-chime.mp3` を着地タイミングに再生して、演出と同期。

## ディレクトリ例
```
temperance/
├─ app/                # ルート（ホーム/獲得/履歴/設定/manifest）
├─ data/               # 初期プリセットやメンターTips
├─ public/             # アイコン、サービスワーカー、効果音
├─ scripts/            # アイコン生成などのツール
├─ src/components/     # UI部品・画面ビュー・レイアウト
├─ src/hooks/          # Dexie用のカスタムHooks
├─ src/lib/            # DB定義、計算ロジック、フォーマット関数など
└─ docs/               # 仕様書や開発メモ
```

## バックアップの扱い
- 設定画面から「JSONを書き出す」でバックアップファイル（例: `temperance-backup-20260117.json`）をダウンロード。
- 別の端末で「JSONを読み込む」を選び、ファイルをアップロードすると IndexedDB の中身が置き換わります。

## デプロイと確認
1. Vercel 等にデプロイして、Android Chrome からアクセス。
2. 「ホーム画面に追加」でアイコンが機能するか確認。
3. 機内モードでも `/add` → ホームで数値が更新されることを確かめる。

## ドキュメント
- `docs/SPEC.md`: 仕様書（唯一の正しい情報源）
- `docs/AGENTS.md`: 開発ルール（やさしい日本語）
- `docs/dev_history.md`: 開発の流れや Git/GitHub の基本

わからないことがあれば `docs/` フォルダの資料を参照してください。
